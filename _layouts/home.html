<!DOCTYPE html>
<html lang="ja">
<head>
    {% include head.html %}
    <style>
        body.no-scroll { overflow: hidden; }

        /* --- Opener --- */
        #opener { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 10000; background-color: var(--background); transition: opacity 0.5s ease-out; display: flex; justify-content: center; align-items: center; }
        .opener-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        .opener-layer.hidden { display: none; }
        #video-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85vw; aspect-ratio: 16 / 9; box-shadow: 0 0 35px 5px rgba(184, 159, 93, 0.2); }
        #opening-video { width: 100%; height: 100%; object-fit: contain; }
        #loader { flex-direction: column; }
        #loader-logo { max-width: 400px; width: 70%; opacity: 0; }
        #loader-percentage { font-family: 'Lato', sans-serif; font-size: 1rem; color: var(--text-muted); margin-top: 1.5rem; z-index: 10; }
        .loader-border { position: absolute; background-color: var(--accent-gold); box-shadow: 0 0 15px var(--accent-gold); }
        .loader-border-top { top: 0; left: 0; width: 0; height: 2px; }
        .loader-border-right { top: 0; right: 0; width: 2px; height: 0; }
        .loader-border-bottom { bottom: 0; right: 0; width: 0; height: 2px; }
        .loader-border-left { bottom: 0; left: 0; width: 2px; height: 0; }

        #main-pin-container { width: 100%; min-height: 100vh; overflow: visible; }
        #main-content-wrapper { width: 100%; display: flex; flex-direction: column; gap: 0; }

        /* --- New Journal Carousel --- */
        #new-journal-section { background: rgba(10, 10, 10, 0.35); backdrop-filter: blur(6px); }
        .new-journal-header { display: flex; flex-direction: column; gap: 0.75rem; text-align: left; }
        .section-kicker { font-size: 0.85rem; letter-spacing: 0.35em; text-transform: uppercase; color: rgba(234, 234, 234, 0.75); }
        .new-journal-title { font-size: clamp(2.5rem, 4vw, 3.5rem); color: var(--text-main); }
        .new-journal-actions { margin-top: 1rem; display: flex; gap: 1rem; align-items: center; }
        .new-journal-actions a { letter-spacing: 0.2em; font-size: 0.85rem; }
        .journal-carousel-shell { margin-top: 2.5rem; position: relative; }
        .journal-carousel { display: flex; gap: 1.5rem; overflow-x: auto; scroll-snap-type: x mandatory; padding-bottom: 1rem; -ms-overflow-style: none; scrollbar-width: none; }
        .journal-carousel::-webkit-scrollbar { display: none; }
        .journal-card { flex: 0 0 82%; max-width: 82%; scroll-snap-align: start; background: rgba(17, 17, 17, 0.85); border: 1px solid rgba(184, 159, 93, 0.1); border-radius: 18px; padding: 2rem; display: flex; flex-direction: column; gap: 1rem; min-height: 320px; position: relative; overflow: hidden; }
        @media (min-width: 768px) { .journal-card { flex-basis: 30%; max-width: 30%; } }
        .journal-card::after { content: ''; position: absolute; inset: 0; background: radial-gradient(circle at 30% 20%, rgba(184, 159, 93, 0.15), transparent 60%); opacity: 0; transition: opacity 0.4s ease; }
        .journal-card:hover::after { opacity: 1; }
        .journal-card__date { font-size: 0.9rem; color: rgba(234, 234, 234, 0.6); letter-spacing: 0.3em; text-transform: uppercase; }
        .journal-card__title { font-size: 1.5rem; color: var(--text-main); text-shadow: 0 5px 20px rgba(0,0,0,0.4); }
        .journal-card__excerpt { color: var(--text-muted); line-height: 1.8; flex-grow: 1; }
        .journal-card__link { align-self: flex-start; display: inline-flex; align-items: center; gap: 0.5rem; letter-spacing: 0.2em; font-size: 0.85rem; text-transform: uppercase; color: var(--accent-gold); }
        .journal-carousel-controls { margin-top: 1rem; display: flex; gap: 0.75rem; justify-content: flex-end; }
        .journal-nav-btn { width: 48px; height: 48px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); background: rgba(17,17,17,0.6); color: var(--text-main); display: flex; align-items: center; justify-content: center; transition: transform 0.3s ease, border-color 0.3s ease; }
        .journal-nav-btn:hover { transform: translateY(-2px); border-color: var(--accent-gold); color: var(--accent-gold); }
        .journal-nav-btn:disabled { opacity: 0.35; pointer-events: none; }
        @media (max-width: 768px) {
            .journal-card { padding: 1.5rem; min-height: 280px; }
            .journal-carousel-controls { justify-content: center; }
        }
    </style>
</head>
<body class="no-scroll">
    <div id="page-transition" class="is-active"></div>
    <div class="cursor-dot"></div>
    <div class="cursor-ring"></div>

    <!-- Opener -->
    <div id="opener">
        <div id="video-container" class="opener-layer">
            <video id="opening-video" autoplay muted playsinline src="{{ '/open.anim.mp4' | relative_url }}">Your browser does not support the video tag.</video>
        </div>
        <div id="loader" class="opener-layer hidden">
            <div class="loader-border loader-border-top"></div>
            <div class="loader-border loader-border-right"></div>
            <div class="loader-border loader-border-bottom"></div>
            <div class="loader-border loader-border-left"></div>
            <img id="loader-logo" src="{{ '/images/rogo.webp' | relative_url }}" alt="Regalis Logo" loading="lazy">
            <div id="loader-percentage">0%</div>
        </div>
    </div>

    {% include header.html %}

    {{ content }}
    
    {% include footer.html %}

    <script src="{{ '/assets/js/main.js' | relative_url }}" defer></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const opener = document.getElementById('opener');
            const openingVideo = document.getElementById('opening-video');
            const videoContainer = document.getElementById('video-container');
            const loader = document.getElementById('loader');
            const loaderLogo = document.getElementById('loader-logo');
            const loaderPercentage = document.getElementById('loader-percentage');
            const mainPinContainer = document.getElementById('main-pin-container');

            const finishIntro = () => {
                if (opener) {
                    opener.style.opacity = '0';
                    setTimeout(() => opener.style.display = 'none', 600);
                }
                if (mainPinContainer) {
                    mainPinContainer.style.visibility = 'visible';
                }
                document.body.classList.remove('no-scroll');
            };

            const runLoaderFallback = () => {
                if (videoContainer) videoContainer.style.display = 'none';
                if (loader) loader.classList.remove('hidden');

                let percent = 0;
                const timer = setInterval(() => {
                    percent = Math.min(100, percent + 2);
                    if (loaderLogo) loaderLogo.style.opacity = Math.min(1, percent / 100);
                    if (loaderPercentage) loaderPercentage.textContent = `${percent}%`;
                    if (percent >= 100) {
                        clearInterval(timer);
                        finishIntro();
                    }
                }, 20);
            };

            if (openingVideo) {
                openingVideo.addEventListener('ended', finishIntro);
                openingVideo.play().catch(runLoaderFallback);
            } else {
                runLoaderFallback();
            }
        });
    </script>

</body>
</html>